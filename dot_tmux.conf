# =============================================================================
# Tmux 配置 - PhilFan
# 支持 tmux 3.6+
# =============================================================================

# -----------------------------------------------------------------------------
# 基础设置
# -----------------------------------------------------------------------------
# 保持默认 prefix 键 Ctrl+b
# set-option -g prefix C-b

# 启用鼠标操作（可点击窗口、面板、拖拽调整大小）
set -g mouse on

# 启用 256 色支持
set -g default-terminal "screen-256color"

# 启用真彩色支持
set -ga terminal-overrides ",xterm-256color:Tc"

# 状态栏刷新间隔（秒）
set -g status-interval 1

# 扩展显示历史限制
set -g history-limit 100000

# 窗口和面板索引从 1 开始（更符合键盘布局）
set -g base-index 1
setw -g pane-base-index 1

# 重新编号窗口时关闭间隙
set -g renumber-windows on

# 防止自动重命名窗口（保持自定义名称）
set-option -g allow-rename off

# -----------------------------------------------------------------------------
# 键绑定
# -----------------------------------------------------------------------------
# 使用 r heload 配置（简化版，无需 prefix）
bind-key r source-file ~/.tmux.conf \; display-message "✅ 配置已重新加载"

# 更直观的窗口分割快捷键（| 水平，- 垂直）
bind-key | split-window -h
bind-key - split-window -v
unbind '"'
unbind %

# 快速切换面板 - Alt+箭头（无需 prefix，最直观）
bind-key -n M-Left select-pane -L
bind-key -n M-Right select-pane -R
bind-key -n M-Up select-pane -U
bind-key -n M-Down select-pane -D

# 快速切换面板 - Alt+hjkl（Vim 风格，无需 prefix）
bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# 使用 Alt+Shift+HJKL 调整面板大小
bind-key -n M-H resize-pane -L 5
bind-key -n M-J resize-pane -D 5
bind-key -n M-K resize-pane -U 5
bind-key -n M-L resize-pane -R 5

# 使用 Ctrl+hjkl 切换窗口
bind-key -n C-h select-window -t :-
bind-key -n C-l select-window -t :+

# 使用 Alt+数字直接切换窗口
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# 快速切换面板
bind-key Tab last-pane
bind-key bspace previous-window
bind-key space next-window

# 复制/粘贴模式使用 vi 键位
setw -g mode-keys vi

# -----------------------------------------------------------------------------
# 主题色板 - Rootloops.sh
# -----------------------------------------------------------------------------
# 背景色: background=#01070e, foreground=#eaf5fe
# 红色: red=#ff506e, yellow=#cc8a00, black=#052539, white=#eaf5fe

# -----------------------------------------------------------------------------
# 状态栏外观
# -----------------------------------------------------------------------------
# 状态栏位置
set -g status-position bottom

# 状态栏对齐
set -g status-justify left

# 状态栏样式
set -g status-style 'fg=#ff506e'

# 左侧状态栏（空）
set -g status-left ''
set -g status-left-length 10

# 右侧状态栏（时间和日期）
set -g status-right-style 'fg=#052539 bg=#cc8a00'
set -g status-right '%Y-%m-%d %H:%M '
set -g status-right-length 50

# 窗口列表格式
setw -g window-status-format ' #[fg=#ff506e]#I #[fg=#eaf5fe]#W#[fg=#cc8a00]#F '
setw -g window-status-current-format ' #[fg=#052539]#I #[fg=#ff506e]#W #[fg=#052539]#F '
setw -g window-status-last-style 'fg=#e79d00'
setw -g window-status-bell-style 'fg=#cc8a00 bg=#ff506e bold'

# 面板边框样式
set -g pane-border-style 'fg=#ff506e'
set -g pane-active-border-style 'fg=#cc8a00'

# 消息提示样式
set -g message-style 'fg=#cc8a00 bg=#ff506e bold'
set -g message-command-style 'fg=#cc8a00 bg=#ff506e bold'

# -----------------------------------------------------------------------------
# 面板行为
# -----------------------------------------------------------------------------
# 新窗口保持在当前路径（启用当前路径）
bind-key c new-window -c "#{pane_current_path}"

# 同步输入（所有面板同步输入）
bind-key * setw synchronize-panes

# -----------------------------------------------------------------------------
# 编辑器集成
# -----------------------------------------------------------------------------
# 使用 $EDITOR 打开 scrollback buffer
bind-key e copy-mode -u \; send-keys -X begin-selection \; send-keys -X rectangle-toggle \; send-keys -X cursor-at-top \; run-shell 'EDITOR=vim tmux show-buffer | $EDITOR -'

# -----------------------------------------------------------------------------
# 性能优化
# -----------------------------------------------------------------------------
# 减少转义序列延迟
set -sg escape-time 10

# 增加 scrollback 缓冲区（已在上面设置 history-limit）

# -----------------------------------------------------------------------------
# Bell 行为
# -----------------------------------------------------------------------------
# 不做任何操作当 bell 响铃时
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# -----------------------------------------------------------------------------
# Clock mode
# -----------------------------------------------------------------------------
setw -g clock-mode-colour #cc8a00

# -----------------------------------------------------------------------------
# Copy mode
# -----------------------------------------------------------------------------
setw -g mode-style 'fg=#052539 bg=#ff506e bold'

# -----------------------------------------------------------------------------
# 搜索和复制
# -----------------------------------------------------------------------------
# Vi 风格复制模式键位
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle
bind-key -T copy-mode-vi C-v send-keys -X page-down
bind-key -T copy-mode-vi M-v send-keys -X page-up

# 鼠标复制到系统剪贴板
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-no-clear "pbcopy"
bind-key -T copy-mode-vi DoubleClick1Pane send-keys -X select-word \; run-shell "tmux send-keys -X copy-pipe-and-cancel pbcopy"
bind-key -T copy-mode-vi TripleClick1Pane send-keys -X select-line \; run-shell "tmux send-keys -X copy-pipe-and-cancel pbcopy"

# -----------------------------------------------------------------------------
# 会话管理
# -----------------------------------------------------------------------------
# 保存会话列表（可选，需要插件）
# set -g @continuum-save 'on'
# set -g @continuum-restore 'on'
